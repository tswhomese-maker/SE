<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢ç¢¼æ¯”å°å°å·¥å…· - Code 39 å°ˆç”¨</title>
    <script src="https://unpkg.com/html5-qrcode/html5-qrcode.min.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --error: #dc3545; }
        body { font-family: -apple-system, sans-serif; text-align: center; background-color: #f8f9fa; padding: 10px; margin: 0; }
        h2 { color: #333; margin: 15px 0; }
        #reader { width: 100%; max-width: 500px; margin: auto; border-radius: 12px; overflow: hidden; background: #000; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .info { background: white; padding: 20px; border-radius: 12px; margin: 15px auto; max-width: 460px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .code-box { font-family: monospace; font-size: 1.2em; padding: 12px; border: 2px dashed #ccc; margin: 10px 0; border-radius: 8px; word-break: break-all; min-height: 1.5em; }
        .active-scan { border-color: var(--primary); background-color: #f0f7ff; }
        .success { border: 3px solid var(--success) !important; background-color: #e6ffed !important; }
        .error { border: 3px solid var(--error) !important; background-color: #fff5f5 !important; }
        #msg { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; color: var(--primary); }
        button { width: 100%; padding: 15px; font-size: 1.1em; cursor: pointer; border-radius: 8px; border: none; background: var(--primary); color: white; font-weight: bold; }
    </style>
</head>
<body>

    <h2>æ¢ç¢¼é›™é‡æ¯”å° (Code 39)</h2>
    <div id="reader"></div>

    <div class="info" id="status-area">
        <div id="msg">ç­‰å¾…å•Ÿå‹•ç›¸æ©Ÿ...</div>
        <div class="code-box" id="display1">æ¢ç¢¼ 1: å¾…æƒæ</div>
        <div class="code-box" id="display2">æ¢ç¢¼ 2: å¾…æƒæ</div>
        <button onclick="resetApp()">é‡æ–°é–‹å§‹</button>
    </div>

    <script>
        let code1 = "";
        let code2 = "";
        const msg = document.getElementById('msg');
        const d1 = document.getElementById('display1');
        const d2 = document.getElementById('display2');
        const statusArea = document.getElementById('status-area');

        function onScanSuccess(decodedText) {
            // è‡ªå‹•éæ¿¾ Excel ç”¢ç”Ÿçš„å•Ÿå§‹èˆ‡çµæŸæ˜Ÿè™Ÿ *
            let cleanText = decodedText.replace(/^\*|\*$/g, "");

            if (!code1) {
                code1 = cleanText;
                d1.innerText = "æ¢ç¢¼ 1: " + code1;
                d1.classList.add("success");
                msg.innerText = "âœ… ç¬¬ä¸€çµ„æˆåŠŸï¼Œè«‹æƒç¬¬äºŒçµ„";
                
                // æš«åœ 2 ç§’é˜²æ­¢é‡è¤‡è®€å–åŒä¸€æ¢ç¢¼
                html5QrcodeScanner.pause(true);
                setTimeout(() => { if(!code2) html5QrcodeScanner.resume(); }, 2000);
            } else if (!code2) {
                code2 = cleanText;
                d2.innerText = "æ¢ç¢¼ 2: " + code2;
                compare();
            }
        }

        function compare() {
            if (code1 === code2) {
                msg.innerText = "ğŸ‰ æ¯”å°æˆåŠŸï¼å…§å®¹ä¸€è‡´";
                statusArea.className = "info success";
                d2.classList.add("success");
            } else {
                msg.innerText = "âŒ æ¯”å°å¤±æ•—ï¼å…§å®¹ä¸åŒ";
                statusArea.className = "info error";
                d2.classList.add("error");
            }
            html5QrcodeScanner.pause(true); 
        }

        function resetApp() {
            code1 = ""; code2 = "";
            d1.innerText = "æ¢ç¢¼ 1: å¾…æƒæ"; d2.innerText = "æ¢ç¢¼ 2: å¾…æƒæ";
            d1.className = "code-box"; d2.className = "code-box";
            msg.innerText = "è«‹æƒæã€ç¬¬ä¸€å€‹ã€‘æ¢ç¢¼";
            statusArea.className = "info";
            try { html5QrcodeScanner.resume(); } catch (e) { html5QrcodeScanner.render(onScanSuccess); }
        }

        const html5QrcodeScanner = new Html5QrcodeScanner("reader", { 
            fps: 20, 
            qrbox: { width: 350, height: 120 }, // é‡å°é•·æ¢ç¢¼èª¿æ•´æƒæç¯„åœ
            aspectRatio: 1.0,
            // é—œéµå„ªåŒ–ï¼šæŒ‡å®šåªè®€å– Code 39 æ ¼å¼
            formatsToSupport: [ Html5QrcodeSupportedFormats.CODE_39 ]
        });

        html5QrcodeScanner.render(onScanSuccess);
    </script>
</body>
</html>
