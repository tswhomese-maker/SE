<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢ç¢¼æ¯”å°å°å·¥å…· 2026</title>
    <script src="https://unpkg.com/html5-qrcode/html5-qrcode.min.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --error: #dc3545; }
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; text-align: center; background-color: #f8f9fa; padding: 10px; margin: 0; }
        h2 { color: #333; margin: 15px 0; font-size: 1.4em; }
        #reader { width: 100%; max-width: 500px; margin: auto; border-radius: 12px; overflow: hidden; background: #000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .info { background: white; padding: 20px; border-radius: 12px; margin: 15px auto; max-width: 460px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .code-box { font-family: 'Courier New', monospace; font-size: 1.1em; padding: 12px; border: 2px dashed #ccc; margin: 10px 0; border-radius: 8px; word-break: break-all; min-height: 1.5em; background: #fff; }
        .success { border: 3px solid var(--success) !important; background-color: #e6ffed !important; }
        .error { border: 3px solid var(--error) !important; background-color: #fff5f5 !important; }
        #msg { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; color: var(--primary); }
        button { width: 100%; padding: 15px; font-size: 1.1em; cursor: pointer; border-radius: 8px; border: none; background: var(--primary); color: white; font-weight: bold; margin-top: 10px; }
        button:active { opacity: 0.8; transform: scale(0.98); }
        /* éš±è—å¥—ä»¶å…§å»ºçš„æª”æ¡ˆä¸Šå‚³æŒ‰éˆ•ï¼Œä¿æŒä»‹é¢ç°¡æ½” */
        #reader__dashboard_section_csr button { padding: 5px 10px; font-size: 0.8em; }
    </style>
</head>
<body>

    <h2>æ¢ç¢¼é›™é‡æ¯”å°å™¨</h2>
    
    <div id="reader"></div>

    <div class="info" id="status-area">
        <div id="msg">è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å•Ÿå‹•ç›¸æ©Ÿ</div>
        <div class="code-box" id="display1">æ¢ç¢¼ 1: å¾…æƒæ</div>
        <div class="code-box" id="display2">æ¢ç¢¼ 2: å¾…æƒæ</div>
        <button onclick="resetApp()">é‡æ–°é–‹å§‹ / å•Ÿå‹•æƒæ</button>
    </div>

    <script>
        let code1 = "";
        let code2 = "";
        const msg = document.getElementById('msg');
        const d1 = document.getElementById('display1');
        const d2 = document.getElementById('display2');
        const statusArea = document.getElementById('status-area');

        // éŸ³é »è™•ç†
        let audioCtx;
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(isSuccess) {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (isSuccess) {
                osc.frequency.setValueAtTime(880, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(110, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function onScanSuccess(decodedText) {
            // é¿å…é‡è¤‡æƒæç›¸åŒå…§å®¹
            if (decodedText === code1 && !code2) return;

            if (!code1) {
                code1 = decodedText;
                d1.innerText = "æ¢ç¢¼ 1: " + code1;
                d1.classList.add("success");
                msg.innerText = "âœ… å·²è®€å–æ¢ç¢¼ 1ï¼Œè«‹æƒæã€ç¬¬äºŒå€‹ã€‘";
                playSound(true);
                
                // æš«åœä¸€ä¸‹å†ç¹¼çºŒï¼Œé¿å…é€£çºŒèª¤æƒ
                html5QrcodeScanner.pause(true);
                setTimeout(() => {
                    if(!code2) html5QrcodeScanner.resume();
                }, 2000);
                
            } else if (!code2) {
                code2 = decodedText;
                d2.innerText = "æ¢ç¢¼ 2: " + code2;
                compare();
            }
        }

        function compare() {
            if (code1 === code2) {
                msg.innerText = "ğŸ‰ æ¯”å°æˆåŠŸï¼å…§å®¹å®Œå…¨ä¸€è‡´";
                statusArea.className = "info success";
                d2.classList.add("success");
                playSound(true);
            } else {
                msg.innerText = "âŒ æ¯”å°å¤±æ•—ï¼å…§å®¹ä¸ç¬¦";
                statusArea.className = "info error";
                d2.classList.add("error");
                playSound(false);
            }
            html5QrcodeScanner.pause(true); 
        }

        function resetApp() {
            code1 = ""; code2 = "";
            d1.innerText = "æ¢ç¢¼ 1: å¾…æƒæ"; d2.innerText = "æ¢ç¢¼ 2: å¾…æƒæ";
            d1.className = "code-box"; d2.className = "code-box";
            msg.innerText = "è«‹æƒæã€ç¬¬ä¸€å€‹ã€‘æ¢ç¢¼";
            statusArea.className = "info";
            try {
                html5QrcodeScanner.resume();
            } catch (e) {
                // å¦‚æœå°šæœªåˆå§‹åŒ–å‰‡é‡æ–°æ¸²æŸ“
                html5QrcodeScanner.render(onScanSuccess);
            }
        }

        // åˆå§‹åŒ–æƒæå™¨
        const html5QrcodeScanner = new Html5QrcodeScanner("reader", { 
            fps: 10, 
            qrbox: { width: 280, height: 180 }, 
            aspectRatio: 1.0,
            rememberLastUsedCamera: true,
            supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
        });

        // å•Ÿå‹•
        html5QrcodeScanner.render(onScanSuccess);

        // è™•ç†ç€è¦½å™¨éŸ³æ•ˆè§£é–
        document.body.addEventListener('touchstart', initAudio, { once: true });
    </script>
</body>
</html>
